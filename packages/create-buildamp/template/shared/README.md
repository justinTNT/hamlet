# Elm Model Definitions

This directory contains the source-of-truth type definitions for your application.
BuildAmp parses these Elm files to generate:
- SQL migrations
- JavaScript API routes
- Elm API clients
- KV store functions
- Browser storage helpers
- SSE event types

## Directory Structure

```
shared/
├── Framework/       # Framework type aliases (don't modify)
│   ├── Schema.elm   # DB types: DatabaseId, Timestamp, Host, ForeignKey
│   └── Api.elm      # API types: Inject, Required, Trim
├── Schema/          # Database models → generates SQL + queries
├── Api/             # API endpoints → generates routes + clients
├── Storage/         # Browser localStorage models
├── Kv/              # Redis/KV store models
├── Sse/             # Server-sent event types
├── Events/          # Background job event types
└── Config/          # App configuration types
```

## Defining Models

### Database Models (Schema/)

```elm
module Schema.User exposing (..)

import Framework.Schema exposing (..)

type alias User =
    { id : DatabaseId String       -- Primary key with UUID
    , host : Host                  -- Multi-tenant isolation
    , email : String               -- Required field
    , name : Maybe String          -- Optional field
    , createdAt : Timestamp        -- Auto-populated timestamp
    , roleId : ForeignKey Role String  -- Foreign key to Role
    }
```

### API Endpoints (Api/)

```elm
module Api.CreateUser exposing (..)

import Framework.Api exposing (..)

type alias Request =
    { host : Inject String              -- Server-injected
    , email : Required (Trim String)    -- Required + trimmed
    , name : Maybe String               -- Optional
    }

type alias Response =
    { user : User
    }

type alias ServerContext =
    { freshUserId : String              -- Generated by server
    }
```

### Storage Models (Storage/)

```elm
module Storage.UserPrefs exposing (..)

type alias UserPrefs =
    { theme : String
    , fontSize : Int
    }
```

## Generating Code

```bash
npx buildamp gen --src models --dest .
```

This parses all Elm files and generates the corresponding JS/Elm glue code.
