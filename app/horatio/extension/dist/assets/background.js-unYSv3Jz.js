console.log("Hamlet Extension Background Service Worker Starting...");const g="http://localhost:3000/api",c=typeof browser<"u",o=c?browser:chrome;!c&&o.declarativeContent&&o.runtime.onInstalled.addListener(()=>{o.action.disable(),o.declarativeContent.onPageChanged.removeRules(void 0,()=>{o.declarativeContent.onPageChanged.addRules([{conditions:[new o.declarativeContent.PageStateMatcher({pageUrl:{schemes:["http","https"]}})],actions:[new o.declarativeContent.ShowAction]}])})});o.runtime.onMessage.addListener((n,a,r)=>(console.log("Background received:",n),p(n).then(e=>{console.log("Background sending response:",e),r(e)}).catch(e=>{console.error("Background error:",e),r({correlationId:n.correlationId,body:null,error:e.toString()})}),!0));async function h(){return g}async function p(n){const{endpoint:a,body:r,correlationId:e,apiUrl:i,hostKey:s}=n,l=`${i||await h()}/${a}`;try{const t={"Content-Type":"application/json","X-Hamlet-Source":"extension"};s&&(t["X-Hamlet-Host-Key"]=s);const d=await(await fetch(l,{method:"POST",headers:t,body:JSON.stringify(r)})).text(),u=JSON.parse(d);return{correlationId:e,body:u,error:null}}catch(t){return console.error("Network error:",t),{correlationId:e,body:null,error:"Network Error: "+t.message}}}
