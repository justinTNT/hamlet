(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const l=window.Elm;console.log("Popup script loaded. Window.Elm:",window.Elm);chrome.tabs.query({active:!0,currentWindow:!0},n=>{console.log("Tabs query result:",n);const t=n[0];if(!t){console.log("No active tab found."),c({title:"",url:"",selection:"",images:[]});return}chrome.scripting.executeScript({target:{tabId:t.id},func:()=>{const r=window.getSelection().toString(),i=Array.from(document.images).map(e=>e.src).filter(e=>e.startsWith("http"));return{selection:r,images:i}}},r=>{console.log("Script execution results:",r);let i={title:t.title||"",url:t.url||"",selection:"",images:[]};r&&r[0]&&r[0].result&&(i.selection=r[0].result.selection||"",i.images=r[0].result.images||[]),c(i)})});function c(n){console.log("Initializing Elm with flags:",n);try{const t=l.Popup.init({node:document.getElementById("app"),flags:n});console.log("Elm initialized successfully."),u(t)}catch(t){console.error("Failed to initialize Elm:",t)}}function u(n){n.ports.outbound.subscribe(function(t){const{apiUrl:r,payload:i}=t,e={...i,apiUrl:r};console.log("Popup sending message:",e),chrome.runtime.sendMessage(e,function(o){console.log("Popup received response:",o),chrome.runtime.lastError?(console.error("Runtime error:",chrome.runtime.lastError),n.ports.inbound.send({correlationId:i.correlationId,body:null,error:chrome.runtime.lastError.message})):n.ports.inbound.send(o)})})}
