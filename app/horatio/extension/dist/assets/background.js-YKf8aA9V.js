console.log("Hamlet Extension Background Service Worker Starting...");const u="http://localhost:3000/api",s=typeof browser<"u",n=s?browser:chrome;!s&&n.declarativeContent&&n.runtime.onInstalled.addListener(()=>{n.action.disable(),n.declarativeContent.onPageChanged.removeRules(void 0,()=>{n.declarativeContent.onPageChanged.addRules([{conditions:[new n.declarativeContent.PageStateMatcher({pageUrl:{schemes:["http","https"]}})],actions:[new n.declarativeContent.ShowAction]}])})});n.runtime.onMessage.addListener((o,a,r)=>(console.log("Background received:",o),h(o).then(e=>{console.log("Background sending response:",e),r(e)}).catch(e=>{console.error("Background error:",e),r({correlationId:o.correlationId,body:null,error:e.toString()})}),!0));async function g(){return u}async function h(o){const{endpoint:a,body:r,correlationId:e,apiUrl:c}=o,i=`${c||await g()}/${a}`;try{const l=await(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-Hamlet-Source":"extension"},body:JSON.stringify(r)})).text(),d=JSON.parse(l);return{correlationId:e,body:d,error:null}}catch(t){return console.error("Network error:",t),{correlationId:e,body:null,error:"Network Error: "+t.message}}}
