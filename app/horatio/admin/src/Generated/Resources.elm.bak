module Generated.Resources exposing (..)

{-| Auto-generated admin UI resources from Rust database models

This module provides type-safe admin forms and views for all database entities.
Generated from Rust structs in app/*/models/db/

# Resource Types
@docs Resource, resourceToString, allResources

# Form Views  
@docs viewForm, FormModel, initFormModel

# Table Views
@docs viewTable, TableConfig

# Utilities
@docs resourceFromString

-}

import Html exposing (..)
import Html.Attributes exposing (..)
import Html.Events exposing (..)
import Json.Encode as Encode
import Json.Decode as Decode


-- RESOURCE TYPES

{-| All available database resources
-}
type Resource
    = Guest
    | ItemComment
    | ItemTag
    | MicroblogItem
    | Tag


{-| Convert resource to string for routing/API calls
-}
resourceToString : Resource -> String
resourceToString resource =
    case resource of
        Guest -> "guest"
        ItemComment -> "itemcomment"
        ItemTag -> "itemtag"
        MicroblogItem -> "microblogitem"
        Tag -> "tag"


{-| Convert string to resource (for URL parsing)
-}
resourceFromString : String -> Maybe Resource
resourceFromString str =
    case str of
        "guest" -> Just Guest
        "itemcomment" -> Just ItemComment
        "itemtag" -> Just ItemTag
        "microblogitem" -> Just MicroblogItem
        "tag" -> Just Tag
        _ -> Nothing


{-| All available resources
-}
allResources : List Resource
allResources =
    [ Guest
    , ItemComment
    , ItemTag
    , MicroblogItem
    , Tag
    ]


-- FORM MODELS AND VIEWS

{-| Generic form model for all resources
-}
type alias FormModel =
    { resource : Resource
    , fields : List FormField
    , errors : List String
    }

type alias FormField =
    { name : String
    , value : String
    , fieldType : FieldType
    , required : Bool
    }

type FieldType
    = TextInput
    | NumberInput  
    | CheckboxInput
    | TextareaInput
    | DateTimeInput
    | JsonEditor
    | RichTextEditor
    | ReadOnlyId


{-| Initialize form model for a resource
-}
initFormModel : Resource -> FormModel
initFormModel resource =
    { resource = resource
    , fields = getFieldsForResource resource
    , errors = []
    }


{-| Get form fields for Guest
-}
getFieldsForGuest : List FormField
getFieldsForGuest =
    [ 
      { name = "Name"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Picture"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Session id"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Created at"
      , value = ""
      , fieldType = DateTimeInput
      , required = True
      }
    ]


{-| Get form fields for ItemComment
-}
getFieldsForItemComment : List FormField
getFieldsForItemComment =
    [ 
      { name = "Item id"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Guest id"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Parent id"
      , value = ""
      , fieldType = TextInput
      , required = False
      }
    , 
      { name = "Author name"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Text"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Created at"
      , value = ""
      , fieldType = DateTimeInput
      , required = True
      }
    ]


{-| Get form fields for ItemTag
-}
getFieldsForItemTag : List FormField
getFieldsForItemTag =
    [ 
      { name = "Item id"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Tag id"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    ]


{-| Get form fields for MicroblogItem
-}
getFieldsForMicroblogItem : List FormField
getFieldsForMicroblogItem =
    [ 
      { name = "Data"
      , value = ""
      , fieldType = JsonEditor
      , required = True
      }
    , 
      { name = "Created at"
      , value = ""
      , fieldType = DateTimeInput
      , required = True
      }
    , 
      { name = "View count"
      , value = ""
      , fieldType = NumberInput
      , required = True
      }
    ]


{-| Get form fields for MicroblogItemData
-}
getFieldsForMicroblogItemData : List FormField
getFieldsForMicroblogItemData =
    [ 
      { name = "Title"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Link"
      , value = ""
      , fieldType = TextInput
      , required = False
      }
    , 
      { name = "Image"
      , value = ""
      , fieldType = TextInput
      , required = False
      }
    , 
      { name = "Extract"
      , value = ""
      , fieldType = RichTextEditor
      , required = False
      }
    , 
      { name = "Owner comment"
      , value = ""
      , fieldType = RichTextEditor
      , required = True
      }
    ]


{-| Get form fields for Tag
-}
getFieldsForTag : List FormField
getFieldsForTag =
    [ 
      { name = "Id"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Host"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    , 
      { name = "Name"
      , value = ""
      , fieldType = TextInput
      , required = True
      }
    ]

getFieldsForResource : Resource -> List FormField
getFieldsForResource resource =
    case resource of
        Guest -> getFieldsForGuest
        ItemComment -> getFieldsForItemComment
        ItemTag -> getFieldsForItemTag
        MicroblogItem -> getFieldsForMicroblogItem
        Tag -> getFieldsForTag

-- FORM VIEWS

{-| Main form view dispatcher
-}
viewForm : FormModel -> (FormModel -> msg) -> (FormModel -> msg) -> Html msg
viewForm model onUpdate onSubmit =
    div [ class "admin-form" ]
        [ h2 [] [ text ("Edit " ++ resourceToString model.resource) ]
        , viewFormErrors model.errors
        , viewFormFields model onUpdate
        , div [ class "form-actions" ]
            [ button 
                [ onClick (onSubmit model)
                , class "btn btn-primary" 
                ] 
                [ text "Save" ]
            , button 
                [ class "btn btn-secondary"
                , type_ "button"
                ] 
                [ text "Cancel" ]
            ]
        ]

viewFormErrors : List String -> Html msg
viewFormErrors errors =
    if List.isEmpty errors then
        text ""
    else
        div [ class "form-errors" ]
            (List.map (\err -> div [ class "error" ] [ text err ]) errors)

viewFormFields : FormModel -> (FormModel -> msg) -> Html msg
viewFormFields model onUpdate =
    div [ class "form-fields" ]
        (List.map (viewFormField model onUpdate) model.fields)

viewFormField : FormModel -> (FormModel -> msg) -> FormField -> Html msg
viewFormField model onUpdate field =
    div [ class ("form-field form-field-" ++ fieldTypeToString field.fieldType) ]
        [ label [ class "field-label" ] [ text field.name ]
        , viewFieldInput field onUpdate model
        ]

viewFieldInput : FormField -> (FormModel -> msg) -> FormModel -> Html msg
viewFieldInput field onUpdate model =
    case field.fieldType of
        TextInput ->
            input 
                [ type_ "text"
                , value field.value
                , onInput (updateFieldValue field.name model onUpdate)
                , class "form-control"
                ] []
        
        NumberInput ->
            input 
                [ type_ "number"
                , value field.value
                , onInput (updateFieldValue field.name model onUpdate)
                , class "form-control"
                ] []
        
        CheckboxInput ->
            input 
                [ type_ "checkbox"
                , checked (field.value == "true")
                , onCheck (\checked -> updateFieldValue field.name model onUpdate (if checked then "true" else "false"))
                , class "form-control"
                ] []
        
        TextareaInput ->
            textarea 
                [ value field.value
                , onInput (updateFieldValue field.name model onUpdate)
                , class "form-control"
                , rows 4
                ] []
        
        RichTextEditor ->
            div [ class "rich-text-editor" ]
                [ textarea 
                    [ value field.value
                    , onInput (updateFieldValue field.name model onUpdate)
                    , class "form-control markdown-editor"
                    , rows 6
                    , placeholder "Enter markdown..."
                    ] []
                , div [ class "markdown-preview" ]
                    [ text "Preview: (markdown rendering would go here)" ]
                ]
        
        JsonEditor ->
            textarea 
                [ value field.value
                , onInput (updateFieldValue field.name model onUpdate)
                , class "form-control json-editor"
                , rows 8
                ] []
        
        ReadOnlyId ->
            input 
                [ type_ "text"
                , value field.value
                , disabled True
                , class "form-control"
                ] []
        
        DateTimeInput ->
            input 
                [ type_ "datetime-local"
                , value field.value
                , onInput (updateFieldValue field.name model onUpdate)
                , class "form-control"
                ] []

updateFieldValue : String -> FormModel -> (FormModel -> msg) -> String -> msg
updateFieldValue fieldName model onUpdate newValue =
    let
        updateField field =
            if field.name == fieldName then
                { field | value = newValue }
            else
                field
        
        updatedModel =
            { model | fields = List.map updateField model.fields }
    in
    onUpdate updatedModel

fieldTypeToString : FieldType -> String
fieldTypeToString fieldType =
    case fieldType of
        TextInput -> "text"
        NumberInput -> "number"
        CheckboxInput -> "checkbox"
        TextareaInput -> "textarea"
        DateTimeInput -> "datetime"
        JsonEditor -> "json"
        RichTextEditor -> "rich-text"
        ReadOnlyId -> "readonly"

-- Guest Form View (generated from guest.rs)

-- ItemComment Form View (generated from item_comment.rs)

-- ItemTag Form View (generated from item_tag.rs)

-- MicroblogItem Form View (generated from microblog_item.rs)

-- MicroblogItemData Form View (generated from microblog_item.rs)

-- Tag Form View (generated from tag.rs)

-- TABLE VIEWS

type alias TableConfig =
    { resource : Resource
    , sortField : String
    , sortDirection : String
    , currentPage : Int
    , itemsPerPage : Int
    }

{-| Main table view dispatcher
-}
viewTable : TableConfig -> List Encode.Value -> Html msg
viewTable config items =
    case config.resource of
        Guest -> viewGuestTable items
        ItemComment -> viewItemCommentTable items
        ItemTag -> viewItemTagTable items
        MicroblogItem -> viewMicroblogItemTable items
        Tag -> viewTagTable items


{-| Table view for Guest
-}
viewGuestTable : List Encode.Value -> Html msg
viewGuestTable items =
    table [ class "admin-table" ]
        [ thead []
            [ tr []
                [ th [] [ text "Id" ]
                , th [] [ text "Name" ]
                , th [] [ text "Picture" ]
                , th [] [ text "Session id" ]
                , th [] [ text "Created at" ]
                , th [] [ text "Actions" ]
                ]
            ]
        , tbody []
            (List.map viewGuestRow items)
        ]

viewGuestRow : Encode.Value -> Html msg  
viewGuestRow item =
    tr []
        [ td [] [ text (getStringField "id" item) ]
        , td [] [ text (getStringField "name" item) ]
        , td [] [ text (getStringField "picture" item) ]
        , td [] [ text (getStringField "session_id" item) ]
        , td [] [ text (getStringField "created_at" item) ]
        , td []
            [ button [ class "btn btn-sm btn-primary" ] [ text "Edit" ]
            , button [ class "btn btn-sm btn-danger" ] [ text "Delete" ]
            ]
        ]


{-| Table view for ItemComment
-}
viewItemCommentTable : List Encode.Value -> Html msg
viewItemCommentTable items =
    table [ class "admin-table" ]
        [ thead []
            [ tr []
                [ th [] [ text "Id" ]
                , th [] [ text "Item id" ]
                , th [] [ text "Guest id" ]
                , th [] [ text "Parent id" ]
                , th [] [ text "Author name" ]
                , th [] [ text "Actions" ]
                ]
            ]
        , tbody []
            (List.map viewItemCommentRow items)
        ]

viewItemCommentRow : Encode.Value -> Html msg  
viewItemCommentRow item =
    tr []
        [ td [] [ text (getStringField "id" item) ]
        , td [] [ text (getStringField "item_id" item) ]
        , td [] [ text (getStringField "guest_id" item) ]
        , td [] [ text (getStringField "parent_id" item) ]
        , td [] [ text (getStringField "author_name" item) ]
        , td []
            [ button [ class "btn btn-sm btn-primary" ] [ text "Edit" ]
            , button [ class "btn btn-sm btn-danger" ] [ text "Delete" ]
            ]
        ]


{-| Table view for ItemTag
-}
viewItemTagTable : List Encode.Value -> Html msg
viewItemTagTable items =
    table [ class "admin-table" ]
        [ thead []
            [ tr []
                [ th [] [ text "Item id" ]
                , th [] [ text "Tag id" ]
                , th [] [ text "Actions" ]
                ]
            ]
        , tbody []
            (List.map viewItemTagRow items)
        ]

viewItemTagRow : Encode.Value -> Html msg  
viewItemTagRow item =
    tr []
        [ td [] [ text (getStringField "item_id" item) ]
        , td [] [ text (getStringField "tag_id" item) ]
        , td []
            [ button [ class "btn btn-sm btn-primary" ] [ text "Edit" ]
            , button [ class "btn btn-sm btn-danger" ] [ text "Delete" ]
            ]
        ]


{-| Table view for MicroblogItem
-}
viewMicroblogItemTable : List Encode.Value -> Html msg
viewMicroblogItemTable items =
    table [ class "admin-table" ]
        [ thead []
            [ tr []
                [ th [] [ text "Id" ]
                , th [] [ text "Data" ]
                , th [] [ text "Created at" ]
                , th [] [ text "View count" ]
                , th [] [ text "Actions" ]
                ]
            ]
        , tbody []
            (List.map viewMicroblogItemRow items)
        ]

viewMicroblogItemRow : Encode.Value -> Html msg  
viewMicroblogItemRow item =
    tr []
        [ td [] [ text (getStringField "id" item) ]
        , td [] [ text (getStringField "data" item) ]
        , td [] [ text (getStringField "created_at" item) ]
        , td [] [ text (getStringField "view_count" item) ]
        , td []
            [ button [ class "btn btn-sm btn-primary" ] [ text "Edit" ]
            , button [ class "btn btn-sm btn-danger" ] [ text "Delete" ]
            ]
        ]


{-| Table view for MicroblogItemData
-}
viewMicroblogItemDataTable : List Encode.Value -> Html msg
viewMicroblogItemDataTable items =
    table [ class "admin-table" ]
        [ thead []
            [ tr []
                [ th [] [ text "Title" ]
                , th [] [ text "Link" ]
                , th [] [ text "Image" ]
                , th [] [ text "Extract" ]
                , th [] [ text "Owner comment" ]
                , th [] [ text "Actions" ]
                ]
            ]
        , tbody []
            (List.map viewMicroblogItemDataRow items)
        ]

viewMicroblogItemDataRow : Encode.Value -> Html msg  
viewMicroblogItemDataRow item =
    tr []
        [ td [] [ text (getStringField "title" item) ]
        , td [] [ text (getStringField "link" item) ]
        , td [] [ text (getStringField "image" item) ]
        , td [] [ text (getStringField "extract" item) ]
        , td [] [ text (getStringField "owner_comment" item) ]
        , td []
            [ button [ class "btn btn-sm btn-primary" ] [ text "Edit" ]
            , button [ class "btn btn-sm btn-danger" ] [ text "Delete" ]
            ]
        ]


{-| Table view for Tag
-}
viewTagTable : List Encode.Value -> Html msg
viewTagTable items =
    table [ class "admin-table" ]
        [ thead []
            [ tr []
                [ th [] [ text "Id" ]
                , th [] [ text "Host" ]
                , th [] [ text "Name" ]
                , th [] [ text "Created At" ]
                , th [] [ text "Actions" ]
                ]
            ]
        , tbody []
            (List.map viewTagRow items)
        ]

viewTagRow : Encode.Value -> Html msg  
viewTagRow item =
    tr []
        [ td [] [ text (getStringField "id" item) ]
        , td [] [ text (getStringField "host" item) ]
        , td [] [ text (getStringField "name" item) ]
        , td [] [ text (getStringField "created_at" item) ]
        , td []
            [ button [ class "btn btn-sm btn-primary" ] [ text "Edit" ]
            , button [ class "btn btn-sm btn-danger" ] [ text "Delete" ]
            ]
        ]

-- UTILITY FUNCTIONS

{-| Extract string field from JSON value
-}
getStringField : String -> Encode.Value -> String
getStringField fieldName value =
    case Decode.decodeValue (Decode.field fieldName Decode.string) value of
        Ok str -> str
        Err _ -> ""

{-| Extract int field from JSON value  
-}
getIntField : String -> Encode.Value -> Int
getIntField fieldName value =
    case Decode.decodeValue (Decode.field fieldName Decode.int) value of
        Ok num -> num
        Err _ -> 0
